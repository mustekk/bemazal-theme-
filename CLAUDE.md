# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Theme Overview

Bemazal is a modern WordPress theme built with Vite for fast development and optimized production builds. It uses SCSS (with Bootstrap 5), and includes pre-configured JavaScript libraries: Swiper (sliders), Fancybox (lightboxes), and Masonry (grid layouts).

## Development Commands

### Install Dependencies
```bash
npm install
```
Installs all required dependencies. **Important:** Package versions have been updated to work with latest Vite and Swiper versions.

### Development Server
```bash
npm run dev
```
Starts Vite dev server on `http://localhost:5173` with HMR (Hot Module Replacement) and live PHP reloading.

**WordPress Configuration Required:**
Add to `wp-config.php` to enable dev mode:
```php
define('VITE_FORCE_DEV', true);
// Optional: override dev server URL
define('VITE_SERVER', 'http://localhost:5173');
```

### Stop Development Server
**Option 1: Using npm script**
```bash
npm run stop
```

**Option 2: Using shell script**
```bash
./stop-vite.sh
```

**Option 3: Manual**
```bash
# Kill by port
kill -9 $(lsof -ti:5173)

# Or kill all Vite processes
pkill -f "vite"
```

### Production Build
```bash
npm run build
```
Compiles assets to `dist/` directory with:
- Minified and hashed filenames
- PurgeCSS to remove unused styles
- Manifest file for WordPress asset loading

## Architecture

### Asset Loading System

The theme uses a custom Vite integration (not a plugin) defined in `functions.php`:

1. **Development Mode** (`VITE_FORCE_DEV` constant):
   - Loads `/@vite/client` for HMR
   - Loads `/src/js/main.js` directly from Vite dev server
   - PHP files trigger browser reload via `vite-plugin-live-reload`

2. **Production Mode**:
   - Reads `dist/manifest.json` to find hashed filenames
   - Enqueues JS and CSS from `dist/` directory
   - Cache busting via `BEMAZAL_VERSION` constant

### Entry Point Flow

**Single Entry Point:** `src/js/main.js`

Import chain:
```
main.js
  ├─ ../scss/main.scss (Bootstrap + custom styles)
  ├─ Swiper (with Navigation, Pagination modules)
  ├─ Fancybox
  └─ Masonry
```

**Conditional Initialization:**
All JavaScript libraries only initialize if their target elements exist in the DOM:
- Swiper: `.swiper` elements
- Fancybox: `[data-fancybox]` attributes
- Masonry: `.masonry-grid` elements

### SCSS Architecture

`src/scss/main.scss` imports Bootstrap via `@use 'bootstrap/scss/bootstrap'` which makes all Bootstrap modules and variables available. Variable overrides must be defined before the `@use` statement.

### Vite Configuration

Key aspects in `vite.config.js`:
- **PurgeCSS:** Scans `./**/*.php` and `./src/js/**/*.js` to remove unused CSS
- **Manifest mode:** Required for WordPress integration
- **No public directory:** All assets go through Vite processing
- **Relative base path:** Ensures URLs work with WordPress theme directory structure

## Template Structure

Standard WordPress hierarchy:
- `header.php`: Site header with Bootstrap nav
- `footer.php`: Site footer
- `index.php`: Main template fallback
- `style.css`: Theme metadata only (actual styles in `dist/`)

## Working with Styles

1. Bootstrap variables can be overridden in `src/scss/main.scss` before the `@use` statement
2. Add custom SCSS files and import them in `main.scss`
3. All Bootstrap utilities and mixins are available after the `@use` statement

## Working with JavaScript

1. Import new libraries via npm: `npm install <package>`
2. Import in `src/js/main.js`
3. Follow conditional initialization pattern (check for DOM elements before running)
4. Vite automatically code-splits imported modules

### Swiper 11+ Import Pattern
Swiper 11 changed module import syntax. Use this pattern:
```javascript
import Swiper from 'swiper';
import { Navigation } from 'swiper/modules';
import { Pagination } from 'swiper/modules';
```

Then register modules in Swiper initialization:
```javascript
new Swiper(el, {
    modules: [Navigation, Pagination],
    // ... options
});
```

## PurgeCSS Considerations

When adding new template files or JavaScript:
- Update `content` array in `vite.config.js` purgeCss plugin if files are outside current patterns
- Current patterns: `./**/*.php` and `./src/js/**/*.js`
- Dynamic class names may be purged; use safelist if needed

## Theme Constants

- `BEMAZAL_VERSION`: Version for cache busting (defined in functions.php)
- `VITE_FORCE_DEV`: Enable dev mode (define in wp-config.php)
- `VITE_SERVER`: Override dev server URL (optional, in wp-config.php)

## WordPress Integration Points

- **functions.php**: Asset enqueuing logic, theme setup, nav menus
- **manifest.json**: Generated by Vite, consumed by WordPress to find asset files
- Text domain: `bemazal` (for translations)
- Admin bar disabled on frontend by default

## Testing the Theme

A demo page template (`page-demo.php`) is available to test all theme features:
1. Create a new page in WordPress admin
2. Select "Demo Page" template
3. Visit the page to see:
   - Swiper slider with navigation and pagination
   - Fancybox lightbox gallery
   - Masonry grid layout
   - Bootstrap components

## Current Package Versions (Tested & Working)

- vite: ^6.0.0
- vite-plugin-live-reload: ^3.0.5 (Live reload confirmed working ✓)
- vite-plugin-purgecss: ^0.2.13
- sass: ^1.81.0
- bootstrap: ^5.3.3
- swiper: ^11.1.14 (requires updated import syntax)
- @fancyapps/ui: ^5.0.36 (CSS path: `@fancyapps/ui/dist/fancybox/fancybox.css`)
- masonry-layout: ^4.2.2

## Known Issues

- Bootstrap SCSS shows deprecation warnings (not critical, affects Bootstrap itself)
- Swiper 10.x import syntax is incompatible - use Swiper 11+ syntax documented above
